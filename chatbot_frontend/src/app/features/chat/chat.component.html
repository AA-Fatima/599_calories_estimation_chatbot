<div class="chat-container">
  <!-- Header -->
  <header class="chat-header">
    <div class="header-left">
      <h1>
        <img alt="logo" width="20px" src="../../../assets/mini-logo.svg"> Calorie Calculator</h1>
      
    </div><div class="country-badge" *ngIf="country">
        {{ country.flag_emoji }} {{ country.name_en }}
        <button class="change-btn" (click)="changeCountry()">Change</button>
      </div>
    <!--<button class="clear-btn" (click)="clearChat()">üóëÔ∏è Clear</button>-->
  </header>

  <!-- Messages Area -->
  <div class="messages-area" #messagesContainer>
    <div 
      class="message" 
      *ngFor="let msg of messages()"
      [class.user]="msg.role === 'user'"
      [class.assistant]="msg.role === 'assistant'">
      
<div *ngIf="msg.role === 'user'" class="message-avatar">
  üë§
</div>

<div *ngIf="msg.role !== 'user'" class="message-avatar">
  <img alt="logo" width="20px" src="../../../assets/mini-logo.svg">
</div>

      <div class="message-content">
        <div  *ngIf="!msg.calorieResult" class="message-bubble" [innerHTML]="formatMessage(msg.content)"></div>
        
        <!-- Calorie Result Card -->
        <div class="calorie-card" *ngIf="msg.calorieResult">
          <div class="calorie-header">
            <h3>{{ msg.calorieResult.food_name }} ({{ msg.calorieResult.weight_g | number:'1.0-0' }}g)</h3>
            <div class="calorie-stats">
            <div class="stat main">
              <span class="value">{{ msg.calorieResult.total_calories | number:'1.0-0' }} kcal</span>
              <span class="label"></span>
            </div></div>
            <!--<span class="source-badge" [class.approximate]="msg.calorieResult.is_approximate">
              {{ msg.calorieResult.is_approximate ? '‚âà Estimate' : '‚úì Verified' }}
            </span>-->
          </div>
          <!-- Modifications -->
          <div class="modifications" *ngIf="msg.calorieResult.modifications && msg.calorieResult.modifications.length > 0">
            <div class="mod-list">
              <span class="mod" *ngFor="let mod of msg.calorieResult.modifications">{{ mod }}</span>
            </div>
          </div>
          
          <div class="calorie-stats">
             <!--             <div class="stat main">
              <span class="value">{{ msg.calorieResult.total_calories | number:'1.0-0' }}</span>
              <span class="label">kcal</span>
            </div>
               <div class="stat">
              <span class="value">{{ msg.calorieResult.weight_g | number:'1.0-0' }}g</span>
              <span class="label">Weight</span>
            </div>
                  <div class="stat">
              <span class="value">{{ (msg.calorieResult.confidence * 100) | number:'1.0-0' }}%</span>
              <span class="label">Confidence</span>
            </div>-->
          </div>
          
          <!-- Ingredients Breakdown -->
          <div class="ingredients" *ngIf="msg.calorieResult.ingredients && msg.calorieResult.ingredients.length > 0">
            <h4>üìù Ingredients</h4>
            <div class="ingredient-list">
              <div class="ingredient" *ngFor="let ing of msg.calorieResult.ingredients">
                <span class="ing-name">{{ ing.name }}</span>
                <span class="ing-details">{{ ing.weight_g }}g ¬∑ {{ ing.calories | number:'1.0-0' }} kcal</span>
              </div>
            </div>
          </div>
          
        </div>
        
        <span class="message-time">{{ msg.timestamp | date:'shortTime' }}</span>
      </div>
    </div>
    
    <!-- Loading indicator -->
    <div class="message assistant" *ngIf="isLoading()">
      <div class="message-avatar">ü§ñ</div>
      <div class="message-content">
        <div class="message-bubble typing">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Queries -->
  <div class="quick-queries">
    <button 
      class="quick-query" 
      *ngFor="let query of quickQueries"
      (click)="sendQuickQuery(query)"
      [disabled]="isLoading()">
      {{ query }}
    </button>
  </div>

  <!-- Input Area -->
  <div class="input-area">
    <div class="input-wrapper">
      <input
        #messageInput
        type="text"
        [(ngModel)]="messageText"
        (keypress)="handleKeyPress($event)"
        placeholder="Ask about any food...  (e.g., 'shawarma calories')"
        [disabled]="isLoading()"
      />
      <button 
        class="send-btn" 
        (click)="sendMessage()" 
        [disabled]="! messageText.trim() || isLoading()">
        <span *ngIf="! isLoading()">‚û§</span>
        <span *ngIf="isLoading()" class="spinner-small"></span>
      </button>
    </div>
     <!--    <p class="input-hint">
      üí° Supports:  English, Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©), and Franco-Arabic (3arabizi)
    </p>-->
  </div>
</div>